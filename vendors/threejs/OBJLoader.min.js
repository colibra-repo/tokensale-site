THREE.OBJLoader=function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,r=/^usemtl /;function i(t){this.manager=void 0!==t?t:THREE.DefaultLoadingManager,this.materials=null}return i.prototype={constructor:i,load:function(t,e,r,i){var a=this,s=new THREE.FileLoader(a.manager);s.setPath(this.path),s.load(t,function(t){e(a.parse(t))},r,i)},setPath:function(t){this.path=t},setMaterials:function(t){return this.materials=t,this},parse:function(i){console.time("OBJLoader");var a=new function(){var t={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var i={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},r&&r.name&&"function"==typeof r.clone){var i=r.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseNormalIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseUVIndex:function(t,e){var r=parseInt(t,10);return 2*(r>=0?r-1:r+e/2)},addVertex:function(t,e,r){var i=this.vertices,a=this.object.geometry.vertices;a.push(i[t+0],i[t+1],i[t+2]),a.push(i[e+0],i[e+1],i[e+2]),a.push(i[r+0],i[r+1],i[r+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,r){var i=this.normals,a=this.object.geometry.normals;a.push(i[t+0],i[t+1],i[t+2]),a.push(i[e+0],i[e+1],i[e+2]),a.push(i[r+0],i[r+1],i[r+2])},addUV:function(t,e,r){var i=this.uvs,a=this.object.geometry.uvs;a.push(i[t+0],i[t+1]),a.push(i[e+0],i[e+1]),a.push(i[r+0],i[r+1])},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,r,i,a,s,n,o,h){var l=this.vertices.length,u=this.parseVertexIndex(t,l),c=this.parseVertexIndex(e,l),m=this.parseVertexIndex(r,l);if(this.addVertex(u,c,m),void 0!==i){var f=this.uvs.length;u=this.parseUVIndex(i,f),c=this.parseUVIndex(a,f),m=this.parseUVIndex(s,f),this.addUV(u,c,m)}if(void 0!==n){var p=this.normals.length;u=this.parseNormalIndex(n,p),c=n===o?u:this.parseNormalIndex(o,p),m=n===h?u:this.parseNormalIndex(h,p),this.addNormal(u,c,m)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var r=this.vertices.length,i=this.uvs.length,a=0,s=t.length;a<s;a++)this.addVertexLine(this.parseVertexIndex(t[a],r));var n=0;for(s=e.length;n<s;n++)this.addUVLine(this.parseUVIndex(e[n],i))}};return t.startObject("",!1),t};-1!==i.indexOf("\r\n")&&(i=i.replace(/\r\n/g,"\n")),-1!==i.indexOf("\\\n")&&(i=i.replace(/\\\n/g,""));for(var s=i.split("\n"),n="",o="",h=[],l="function"==typeof"".trimLeft,u=0,c=s.length;u<c;u++)if(n=s[u],0!==(n=l?n.trimLeft():n.trim()).length&&"#"!==(o=n.charAt(0)))if("v"===o){var m=n.split(/\s+/);switch(m[0]){case"v":a.vertices.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));break;case"vn":a.normals.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));break;case"vt":a.uvs.push(parseFloat(m[1]),parseFloat(m[2]))}}else if("f"===o){for(var f=n.substr(1).trim().split(/\s+/),p=[],d=0,v=f.length;d<v;d++){var g=f[d];if(g.length>0){var b=g.split("/");p.push(b)}}var E=p[0];for(d=1,v=p.length-1;d<v;d++){var j=p[d],x=p[d+1];a.addFace(E[0],j[0],x[0],E[1],j[1],x[1],E[2],j[2],x[2])}}else if("l"===o){var y=n.substring(1).trim().split(" "),L=[],w=[];if(-1===n.indexOf("/"))L=y;else for(var V=0,I=y.length;V<I;V++){var H=y[V].split("/");""!==H[0]&&L.push(H[0]),""!==H[1]&&w.push(H[1])}a.addLineGeometry(L,w)}else if(null!==(h=t.exec(n))){var M=(" "+h[0].substr(1).trim()).substr(1);a.startObject(M)}else if(r.test(n))a.object.startMaterial(n.substring(7).trim(),a.materialLibraries);else if(e.test(n))a.materialLibraries.push(n.substring(7).trim());else{if("s"!==o){if("\0"===n)continue;throw new Error("Unexpected line: '"+n+"'")}if((h=n.split(" ")).length>1){var R=h[1].trim().toLowerCase();a.object.smooth="0"!==R&&"off"!==R}else a.object.smooth=!0;(G=a.object.currentMaterial())&&(G.smooth=a.object.smooth)}a.finalize();var T=new THREE.Group;T.materialLibraries=[].concat(a.materialLibraries);for(u=0,c=a.objects.length;u<c;u++){var F=a.objects[u],A=F.geometry,B=F.materials,U="Line"===A.type;if(0!==A.vertices.length){var O=new THREE.BufferGeometry;O.addAttribute("position",new THREE.BufferAttribute(new Float32Array(A.vertices),3)),A.normals.length>0?O.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(A.normals),3)):O.computeVertexNormals(),A.uvs.length>0&&O.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(A.uvs),2));for(var z,C=[],N=0,S=B.length;N<S;N++){var _=B[N],G=void 0;if(null!==this.materials&&(G=this.materials.create(_.name),U&&G&&!(G instanceof THREE.LineBasicMaterial))){var D=new THREE.LineBasicMaterial;D.copy(G),G=D}G||((G=U?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial).name=_.name),G.flatShading=!_.smooth,C.push(G)}if(C.length>1){for(N=0,S=B.length;N<S;N++){_=B[N];O.addGroup(_.groupStart,_.groupCount,N)}z=U?new THREE.LineSegments(O,C):new THREE.Mesh(O,C)}else z=U?new THREE.LineSegments(O,C[0]):new THREE.Mesh(O,C[0]);z.name=F.name,T.add(z)}}return console.timeEnd("OBJLoader"),T}},i}();